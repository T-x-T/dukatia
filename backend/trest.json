{
	"configs": [
		{
			"name": "backend",
			"description": "tests for the rest api of the backend",
			"setup": {
				"cmd": "docker-compose -f trest.docker-compose.yml build && docker-compose -f trest.docker-compose.yml up -d",
				"finished_condition": {
					"endpoint_reachable": "/api/v1"
				}
			},
			"cleanup": {
				"cmd": "docker-compose -f trest.docker-compose.yml down && rm latest"
			},
			"api_hostname": "http://localhost:4000"
		}
	],
	"tasks": {
		"login_as_admin": {
			"endpoint": "/api/v1/login",
			"method": "POST",
			"body": {
				"name": "admin",
				"secret": "changeme"
			}
		}
	},
	"tests": [
		{
			"name": "currency",
			"tests": [
				{
					"name": "retrieval of all currencies works",
					"endpoint": "/api/v1/currencies/all",
					"method": "GET",
					"cookies": {
						"accessToken": "$login_as_admin.accessToken"
					},
					"before": [
						"login_as_admin"
					],
					"expected_outcome": {
						"status_code_equals": 200,
						"body_equals": [{"id":0,"name":"Euro","minor_in_mayor":100,"symbol":"â‚¬"},{"id":1,"name":"USD","minor_in_mayor":100,"symbol":"$"}]
					} 
				}
			]
		},
		{
			"name": "recipients",
			"tests": [
				{
					"name": "retrieval of all recipients works",
					"endpoint": "/api/v1/recipients/all",
					"method": "GET",
					"cookies": {
						"accessToken": "$login_as_admin.accessToken"
					},
					"before": [
						"login_as_admin"
					],
					"expected_outcome": {
						"status_code_equals": 200,
						"body_equals": [{"id":0,"name":"Default","user_id":null,"tag_ids":[]}]
					}
				},
				{
					"name": "post of new recipient returns 200",
					"endpoint": "/api/v1/recipients",
					"method": "POST",
					"body": {
						"name": "test"
					},
					"cookies": {
						"accessToken": "$login_as_admin.accessToken"
					},
					"before": [
						"login_as_admin"
					],
					"expected_outcome": {
						"status_code_equals": 200
					}
				},
				{
					"name": "new recipient created correctly",
					"endpoint": "/api/v1/recipients/all",
					"method": "GET",
					"cookies": {
						"accessToken": "$login_as_admin.accessToken"
					},
					"before": [
						"login_as_admin"
					],
					"expected_outcome": {
						"status_code_equals": 200,
						"body_equals": [{"id":0,"name":"Default","user_id":null,"tag_ids":[]}, {"id":1,"name":"test","user_id":0,"tag_ids":[]}]
					}
				},
				{
					"name": "updating name of recipient returns 200",
					"endpoint": "/api/v1/recipients/1",
					"method": "PUT",
					"body": {
						"name":"edited test"
					},
					"cookies": {
						"accessToken": "$login_as_admin.accessToken"
					},
					"before": [
						"login_as_admin"
					],
					"expected_outcome": {
						"status_code_equals": 200
					}
				},
				{
					"name": "updated recipient name saved correctly",
					"endpoint": "/api/v1/recipients/all",
					"method": "GET",
					"cookies": {
						"accessToken": "$login_as_admin.accessToken"
					},
					"before": [
						"login_as_admin"
					],
					"expected_outcome": {
						"status_code_equals": 200,
						"body_equals": [{"id":0,"name":"Default","user_id":null,"tag_ids":[]}, {"id":1,"name":"edited test","user_id":0,"tag_ids":[]}]
					}
				}
			]
		},
		{
			"name": "accounts",
			"tests": [
				{
					"name": "retrieval of all accounts works",
					"endpoint": "/api/v1/accounts/all",
					"method": "GET",
					"cookies": {
						"accessToken": "$login_as_admin.accessToken"
					},
					"before": [
						"login_as_admin"
					],
					"expected_outcome": {
						"status_code_equals": 200,
						"body_equals": [{"id":0,"name":"Default","default_currency_id":0,"user_id":0,"tag_ids":[]}]
					}
				},
				{
					"name": "post of new account returns 200",
					"endpoint": "/api/v1/accounts",
					"method": "POST",
					"body": {
						"name": "test",
						"default_currency_id": 0
					},
					"cookies": {
						"accessToken": "$login_as_admin.accessToken"
					},
					"before": [
						"login_as_admin"
					],
					"expected_outcome": {
						"status_code_equals": 200
					}
				},
				{
					"name": "new account created correctly",
					"endpoint": "/api/v1/accounts/all",
					"method": "GET",
					"cookies": {
						"accessToken": "$login_as_admin.accessToken"
					},
					"before": [
						"login_as_admin"
					],
					"expected_outcome": {
						"status_code_equals": 200,
						"body_equals": [{"id":0,"name":"Default","default_currency_id":0,"user_id":0,"tag_ids":[]},{"id":1,"name":"test","default_currency_id":0,"user_id":0,"tag_ids":[]}]
					}
				},
				{
					"name": "updating details of account returns 200",
					"endpoint": "/api/v1/accounts/1",
					"method": "PUT",
					"body": {
						"name":"edited test",
						"default_currency_id": 1
					},
					"cookies": {
						"accessToken": "$login_as_admin.accessToken"
					},
					"before": [
						"login_as_admin"
					],
					"expected_outcome": {
						"status_code_equals": 200
					}
				},
				{
					"name": "updated account name saved correctly",
					"endpoint": "/api/v1/accounts/all",
					"method": "GET",
					"cookies": {
						"accessToken": "$login_as_admin.accessToken"
					},
					"before": [
						"login_as_admin"
					],
					"expected_outcome": {
						"status_code_equals": 200,
						"body_equals": [{"id":0,"name":"Default","default_currency_id":0,"user_id":0,"tag_ids":[]},{"id":1,"name":"edited test","default_currency_id":1,"user_id":0,"tag_ids":[]}]
					}
				}
			]
		},
		{
			"name": "tags",
			"tests": [
				{
					"name": "retrieval of all tags works with no tags in the database",
					"endpoint": "/api/v1/tags/all",
					"method": "GET",
					"cookies": {
						"accessToken": "$login_as_admin.accessToken"
					},
					"before": [
						"login_as_admin"
					],
					"expected_outcome": {
						"status_code_equals": 200,
						"body_equals": []
					}
				},
				{
					"name": "post of new tag returns 200",
					"endpoint": "/api/v1/tags",
					"method": "POST",
					"body": {
						"name": "test"
					},
					"cookies": {
						"accessToken": "$login_as_admin.accessToken"
					},
					"before": [
						"login_as_admin"
					],
					"expected_outcome": {
						"status_code_equals": 200
					}
				},
				{
					"name": "new tag created correctly",
					"endpoint": "/api/v1/tags/all",
					"method": "GET",
					"cookies": {
						"accessToken": "$login_as_admin.accessToken"
					},
					"before": [
						"login_as_admin"
					],
					"expected_outcome": {
						"status_code_equals": 200,
						"body_equals": [{"id":0,"name":"test","user_id":0,"parent_id":null}]
					}
				},
				{
					"name": "updating details of tag returns 200",
					"endpoint": "/api/v1/tags/0",
					"method": "PUT",
					"body": {
						"name":"edited test"
					},
					"cookies": {
						"accessToken": "$login_as_admin.accessToken"
					},
					"before": [
						"login_as_admin"
					],
					"expected_outcome": {
						"status_code_equals": 200
					}
				},
				{
					"name": "updated tag name saved correctly",
					"endpoint": "/api/v1/tags/all",
					"method": "GET",
					"cookies": {
						"accessToken": "$login_as_admin.accessToken"
					},
					"before": [
						"login_as_admin"
					],
					"expected_outcome": {
						"status_code_equals": 200,
						"body_equals": [{"id":0,"name":"edited test","user_id":0,"parent_id":null}]
					}
				},
				{
					"name": "deleting tag returns 200",
					"endpoint": "/api/v1/tags/0",
					"method": "DELETE",
					"cookies": {
						"accessToken": "$login_as_admin.accessToken"
					},
					"before": [
						"login_as_admin"
					],
					"expected_outcome": {
						"status_code_equals": 200
					}
				},
				{
					"name": "deleted tag doesnt get returned by get all anymore",
					"endpoint": "/api/v1/tags/all",
					"method": "GET",
					"cookies": {
						"accessToken": "$login_as_admin.accessToken"
					},
					"before": [
						"login_as_admin"
					],
					"expected_outcome": {
						"status_code_equals": 200,
						"body_equals": []
					}
				},
				{
					"name": "post of another tag returns 200",
					"endpoint": "/api/v1/tags",
					"method": "POST",
					"body": {
						"name": "test"
					},
					"cookies": {
						"accessToken": "$login_as_admin.accessToken"
					},
					"before": [
						"login_as_admin"
					],
					"expected_outcome": {
						"status_code_equals": 200
					}
				},
				{
					"name": "second tag gets ID 1, even though tag with ID 0 got deleted",
					"endpoint": "/api/v1/tags/all",
					"method": "GET",
					"cookies": {
						"accessToken": "$login_as_admin.accessToken"
					},
					"before": [
						"login_as_admin"
					],
					"expected_outcome": {
						"status_code_equals": 200,
						"body_equals": [{"id":1,"name":"test","user_id":0,"parent_id":null}]
					}
				},
				{
					"name": "post of third tag returns 200",
					"endpoint": "/api/v1/tags",
					"method": "POST",
					"body": {
						"name": "test"
					},
					"cookies": {
						"accessToken": "$login_as_admin.accessToken"
					},
					"before": [
						"login_as_admin"
					],
					"expected_outcome": {
						"status_code_equals": 200
					}
				},
				{
					"name": "updating parent of tag returns 200",
					"endpoint": "/api/v1/tags/1",
					"method": "PUT",
					"body": {
						"name":"edited test",
						"parent_id": 2
					},
					"cookies": {
						"accessToken": "$login_as_admin.accessToken"
					},
					"before": [
						"login_as_admin"
					],
					"expected_outcome": {
						"status_code_equals": 200
					}
				},
				{
					"name": "updated tag parent_id saved correctly",
					"endpoint": "/api/v1/tags/all",
					"method": "GET",
					"cookies": {
						"accessToken": "$login_as_admin.accessToken"
					},
					"before": [
						"login_as_admin"
					],
					"expected_outcome": {
						"status_code_equals": 200,
						"body_equals": [{"id":2,"name":"test","user_id":0,"parent_id":null},{"id":1,"name":"edited test","user_id":0,"parent_id":2}]
					}
				},
				{
					"name": "creating cyclic parent relationship fails",
					"endpoint": "/api/v1/tags/2",
					"method": "PUT",
					"body": {
						"name":"edited test",
						"parent_id": 1
					},
					"cookies": {
						"accessToken": "$login_as_admin.accessToken"
					},
					"before": [
						"login_as_admin"
					],
					"expected_outcome": {
						"status_code_equals": 400,
						"body_equals": {"error": "the given item is invalid, because parent doesn't exist or would create a cyclic relationship"}
					}
				}
			]
		}
	]
}